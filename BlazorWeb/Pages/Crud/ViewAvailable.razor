@page "/viewavailables"
@inject NavigationManager NavigationManager
@inject UserManager<ApplicationUser> userManager

<table class="table">
	<thead>
		<tr>
			<td>
				Dato
			</td>
			<td>
				Er tiden taget
			</td>
			<td>
				Læge/sygepjeleske
			</td>
		</tr>
	</thead>
	<tbody>
		@foreach (var available in availables)
		{
			<tr>
				<td>
					@available.Date
				</td>
				@if (available.IsTaken == true)
				{
					<td>
						Ja
					</td>
				}
				else
				{
					<td>
						Nej
					</td>
				}

				<td>
					@Employees.Where(e => e.Id == available.EmployeeId).FirstOrDefault().Firstname
					@Employees.Where(e => e.Id == available.EmployeeId).FirstOrDefault().Lastname
				</td>
				<td>
					<a href="/editavailable/@available.AvailableId">
						<i class="bi bi-pencil-square"></i>
					</a>
				</td>
				<td>
					<button @onclick="() => deleteOnClick(available.AvailableId)">
						<i class="bi bi-trash"></i>
					</button>
				</td>
			</tr>
		}
	</tbody>

</table>



@code {
	private List<Available> availables = new List<Available>();
	private List<ApplicationUser> Employees = new List<ApplicationUser>();

	protected override void OnInitialized()
	{
		availables = _availableRepo.GetAllAvailables().ToList();
		List<ApplicationUser> applicationUsers = userManager.Users.ToList();

		Employees.AddRange(applicationUsers.Where(e => e.Role != 0));

	}

	public async Task deleteOnClick(int availableId)
	{
		bool res = await Jsruntime.InvokeAsync<bool>
		("confirm", $"Er du sikker på at du vil slette denne tid?");
		if (res)
		{
			await _availableRepo.DeleteAvailable(availableId);
			toastService.ShowSuccess("Tiden blev fjernet");
			availables = _availableRepo.GetAllAvailables().ToList();
			//NavigationManager.NavigateTo("/");
		}
	}

}